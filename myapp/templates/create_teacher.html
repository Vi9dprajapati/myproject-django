{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Teacher - AI Education Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4cc9f0;
            --primary-dark: #3a0ca3;
            --secondary: #7209b7;
            --secondary-light: #b5179e;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-light));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            --gradient-dark: linear-gradient(135deg, var(--primary-dark), var(--dark));
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.15);
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #f0f2f5 100%);
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Enhanced Navbar */
        .navbar {
            background: var(--gradient-primary);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: 1030;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navbar-brand i {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        /* Main Content */
        .main-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        /* Form Card */
        .form-card {
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-header {
            background: var(--gradient-primary);
            color: white;
            padding: 1.75rem 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .form-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.1) 0%, transparent 70%);
        }
        
        .form-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .form-subtitle {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .form-body {
            padding: 2rem;
        }
        
        /* Form Groups */
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-label i {
            color: var(--primary);
            width: 20px;
        }
        
        .form-control-custom {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e9ecef;
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
            background: #fff;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .form-control-custom:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: #fff;
        }
        
        .form-control-custom:disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        /* Password Strength Indicator */
        .password-strength {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .strength-fill {
            height: 100%;
            width: 0%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .strength-weak { background: var(--danger); }
        .strength-medium { background: var(--warning); }
        .strength-strong { background: var(--success); }
        
        .strength-text {
            font-size: 0.8rem;
            margin-top: 4px;
            text-align: right;
        }
        
        /* Form Validation */
        .valid-feedback,
        .invalid-feedback {
            display: none;
            font-size: 0.85rem;
            margin-top: 4px;
        }
        
        .form-control-custom.is-valid {
            border-color: var(--success);
        }
        
        .form-control-custom.is-valid:focus {
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
        }
        
        .form-control-custom.is-invalid {
            border-color: var(--danger);
        }
        
        .form-control-custom.is-invalid:focus {
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }
        
        .form-control-custom.is-valid + .valid-feedback,
        .form-control-custom.is-invalid + .invalid-feedback {
            display: block;
        }
        
        /* Character Count */
        .char-count {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            color: #6c757d;
            background: white;
            padding: 2px 6px;
            border-radius: 10px;
            pointer-events: none;
        }
        
        .char-count.warning {
            color: var(--warning);
        }
        
        .char-count.danger {
            color: var(--danger);
            font-weight: 600;
        }
        
        /* Error Messages */
        .error-message {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .error-message i {
            font-size: 0.75rem;
        }
        
        /* Form Actions */
        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
        }
        
        .btn {
            padding: 0.875rem 1.75rem;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            border: none;
            cursor: pointer;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: var(--dark);
            border: 1px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        /* Success Message */
        .alert-success {
            background: linear-gradient(135deg, #d1f7c4, #a3e4b2);
            border: none;
            color: #155724;
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Footer */
        footer {
            background: var(--gradient-dark);
            color: white;
            padding: 2rem 0;
            margin-top: 4rem;
        }
        
        .footer-content {
            text-align: center;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                margin: 1rem auto;
                padding: 0 0.75rem;
            }
            
            .form-header {
                padding: 1.5rem;
            }
            
            .form-body {
                padding: 1.5rem;
            }
            
            .form-title {
                font-size: 1.5rem;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        /* Loading State */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e9ecef;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile Input Styles */
        input[type="tel"] {
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="{% url 'admin_dashboard' %}">
                <i class="fas fa-brain"></i>
                <span>EduAI Admin</span>
            </a>
            
            <div class="d-flex align-items-center">
                <span class="navbar-text me-3 d-none d-md-block">Welcome, Admin</span>
                <a href="{% url 'logout' %}" class="btn btn-outline-light btn-sm">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        {% if messages %}
            <div class="messages-container">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        <div class="d-flex align-items-center gap-2">
                            {% if message.tags == 'success' %}
                                <i class="fas fa-check-circle"></i>
                            {% elif message.tags == 'error' %}
                                <i class="fas fa-exclamation-circle"></i>
                            {% endif %}
                            <span>{{ message }}</span>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="form-card">
            <div class="form-header">
                <h1 class="form-title">
                    <i class="fas fa-user-plus me-2"></i>Create New Teacher
                </h1>
                <p class="form-subtitle">Fill in the details below to create a new teacher account</p>
            </div>
            
            <div class="form-body">
                <form method="post" id="createTeacherForm" novalidate>
                    {% csrf_token %}
                    
                    <!-- Username Field -->
                    <div class="form-group">
                        <label for="{{ form.username.id_for_label }}" class="form-label">
                            <i class="fas fa-user"></i>Username
                        </label>
                        {{ form.username }}
                        <div class="valid-feedback">Username available</div>
                        <div class="invalid-feedback">Username is required</div>
                        {% for error in form.username.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Email Field -->
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            <i class="fas fa-envelope"></i>Email Address
                        </label>
                        {{ form.email }}
                        <div class="valid-feedback">Valid email format</div>
                        <div class="invalid-feedback">Please enter a valid email address</div>
                        {% for error in form.email.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Password Field -->
                    <div class="form-group">
                        <label for="{{ form.password1.id_for_label }}" class="form-label">
                            <i class="fas fa-lock"></i>Password
                        </label>
                        {{ form.password1 }}
                        <div class="password-strength">
                            <div class="strength-fill" id="passwordStrength"></div>
                        </div>
                        <div class="strength-text" id="passwordStrengthText"></div>
                        <div class="valid-feedback">Strong password</div>
                        <div class="invalid-feedback">Password must be at least 8 characters</div>
                        {% for error in form.password1.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Confirm Password Field -->
                    <div class="form-group">
                        <label for="{{ form.password2.id_for_label }}" class="form-label">
                            <i class="fas fa-lock"></i>Confirm Password
                        </label>
                        {{ form.password2 }}
                        <div class="valid-feedback">Passwords match</div>
                        <div class="invalid-feedback">Passwords do not match</div>
                        {% for error in form.password2.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Mobile Number Field (India specific) -->
                    <div class="form-group">
                        <label for="{{ form.phone.id_for_label }}" class="form-label">
                            <i class="fas fa-phone"></i>Mobile Number
                            <span class="badge bg-secondary ms-2">India (+91)</span>
                        </label>
                        <div class="input-group">
                            <span class="input-group-text" style="border-radius: var(--radius) 0 0 var(--radius);">
                                <i class="fas fa-flag text-primary me-1"></i>+91
                            </span>
                            {{ form.phone }}
                            <span class="char-count" id="phoneCharCount">0/10</span>
                        </div>
                        <div class="valid-feedback">Valid Indian mobile number</div>
                        <div class="invalid-feedback">Must be 10 digits starting with 6-9</div>
                        {% for error in form.phone.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                        <small class="text-muted mt-1 d-block">
                            <i class="fas fa-info-circle me-1"></i>
                            Enter 10-digit Indian mobile number (starting with 6, 7, 8, or 9)
                        </small>
                    </div>
                    
                    <!-- Name Field -->
                    <div class="form-group">
                        <label for="{{ form.name.id_for_label }}" class="form-label">
                            <i class="fas fa-user-tag"></i>Full Name
                        </label>
                        {{ form.name }}
                        <div class="valid-feedback">Name entered</div>
                        <div class="invalid-feedback">Full name is required</div>
                        {% for error in form.name.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Department Field -->
                    <div class="form-group">
                        <label for="{{ form.department.id_for_label }}" class="form-label">
                            <i class="fas fa-graduation-cap"></i>Department
                        </label>
                        {{ form.department }}
                        <div class="valid-feedback">Department selected</div>
                        <div class="invalid-feedback">Please select a department</div>
                        {% for error in form.department.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Unique ID Field -->
                    <div class="form-group">
                        <label for="{{ form.unique_id.id_for_label }}" class="form-label">
                            <i class="fas fa-id-card"></i>Teacher ID
                        </label>
                        {{ form.unique_id }}
                        <div class="valid-feedback">Unique ID available</div>
                        <div class="invalid-feedback">Teacher ID is required</div>
                        {% for error in form.unique_id.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-circle"></i>{{ error }}
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="form-actions">
                        <a href="{% url 'teacher_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Back to Teachers
                        </a>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-user-plus me-1"></i>Create Teacher Account
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <h6 class="fw-bold mb-2">EduAI Education Platform</h6>
                <p class="mb-0 small">Â© 2024 EduAI Platform. Empowering education with AI technology.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get form elements
            const form = document.getElementById('createTeacherForm');
            const phoneInput = document.getElementById('{{ form.phone.id_for_label }}');
            const phoneCharCount = document.getElementById('phoneCharCount');
            const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
            const passwordStrength = document.getElementById('passwordStrength');
            const passwordStrengthText = document.getElementById('passwordStrengthText');
            const submitBtn = document.getElementById('submitBtn');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // Set maximum length for phone field (10 digits)
            phoneInput.setAttribute('maxlength', '10');
            phoneInput.setAttribute('pattern', '[6-9][0-9]{9}');
            phoneInput.setAttribute('title', 'Enter a valid 10-digit Indian mobile number starting with 6-9');
            
            // Format phone input as user types (only allow numbers)
            phoneInput.addEventListener('input', function(e) {
                // Remove non-numeric characters
                let value = e.target.value.replace(/\D/g, '');
                
                // Limit to 10 digits
                value = value.substring(0, 10);
                
                // Update input value
                e.target.value = value;
                
                // Update character count
                updatePhoneCharCount(value.length);
                
                // Validate phone number
                validatePhoneNumber(value);
            });
            
            // Update character count for phone
            function updatePhoneCharCount(length) {
                phoneCharCount.textContent = `${length}/10`;
                
                // Update color based on length
                if (length === 10) {
                    phoneCharCount.className = 'char-count';
                    phoneCharCount.innerHTML += ' <i class="fas fa-check-circle text-success"></i>';
                } else if (length >= 7) {
                    phoneCharCount.className = 'char-count warning';
                } else if (length > 0) {
                    phoneCharCount.className = 'char-count danger';
                } else {
                    phoneCharCount.className = 'char-count';
                }
            }
            
            // Validate Indian mobile number
            function validatePhoneNumber(number) {
                const phoneRegex = /^[6-9]\d{9}$/;
                const isValid = phoneRegex.test(number);
                
                if (number.length === 0) {
                    phoneInput.classList.remove('is-valid', 'is-invalid');
                } else if (isValid) {
                    phoneInput.classList.remove('is-invalid');
                    phoneInput.classList.add('is-valid');
                } else {
                    phoneInput.classList.remove('is-valid');
                    phoneInput.classList.add('is-invalid');
                }
                
                return isValid;
            }
            
            // Password strength indicator
            passwordInput.addEventListener('input', function(e) {
                const password = e.target.value;
                let strength = 0;
                let strengthText = 'Very Weak';
                let strengthClass = 'strength-weak';
                
                // Check password strength
                if (password.length >= 8) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[a-z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[^A-Za-z0-9]/.test(password)) strength++;
                
                // Set strength level
                if (strength === 0) {
                    strengthText = 'Very Weak';
                    strengthClass = 'strength-weak';
                } else if (strength <= 2) {
                    strengthText = 'Weak';
                    strengthClass = 'strength-weak';
                } else if (strength === 3) {
                    strengthText = 'Medium';
                    strengthClass = 'strength-medium';
                } else if (strength === 4) {
                    strengthText = 'Strong';
                    strengthClass = 'strength-strong';
                } else {
                    strengthText = 'Very Strong';
                    strengthClass = 'strength-strong';
                }
                
                // Update UI
                const strengthPercentage = (strength / 5) * 100;
                passwordStrength.style.width = `${strengthPercentage}%`;
                passwordStrength.className = `strength-fill ${strengthClass}`;
                passwordStrengthText.textContent = strengthText;
                passwordStrengthText.className = `strength-text text-${strengthClass.replace('strength-', '')}`;
                
                // Validate password
                validatePassword(password);
            });
            
            function validatePassword(password) {
                if (password.length >= 8) {
                    passwordInput.classList.remove('is-invalid');
                    passwordInput.classList.add('is-valid');
                } else if (password.length > 0) {
                    passwordInput.classList.remove('is-valid');
                    passwordInput.classList.add('is-invalid');
                } else {
                    passwordInput.classList.remove('is-valid', 'is-invalid');
                }
            }
            
            // Confirm password validation
            const confirmPasswordInput = document.getElementById('{{ form.password2.id_for_label }}');
            confirmPasswordInput.addEventListener('input', function() {
                const password = passwordInput.value;
                const confirmPassword = this.value;
                
                if (confirmPassword.length === 0) {
                    this.classList.remove('is-valid', 'is-invalid');
                } else if (password === confirmPassword && password.length >= 8) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                }
            });
            
            // Username validation
            const usernameInput = document.getElementById('{{ form.username.id_for_label }}');
            usernameInput.addEventListener('input', function() {
                if (this.value.length >= 3) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else if (this.value.length > 0) {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-valid', 'is-invalid');
                }
            });

            // Name validation
            const nameInput = document.getElementById('{{ form.name.id_for_label }}');
            nameInput.addEventListener('input', function() {
                if (this.value.trim().length >= 2) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else if (this.value.length > 0) {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-valid', 'is-invalid');
                }
            });
            
            // Email validation
            const emailInput = document.getElementById('{{ form.email.id_for_label }}');
            emailInput.addEventListener('input', function() {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (emailRegex.test(this.value)) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else if (this.value.length > 0) {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-valid', 'is-invalid');
                }
            });
            
            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validate all fields
                let isValid = true;
                
                // Check username
                if (usernameInput.value.length < 3) {
                    usernameInput.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Check email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(emailInput.value)) {
                    emailInput.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Check password
                if (passwordInput.value.length < 8) {
                    passwordInput.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Check password confirmation
                if (passwordInput.value !== confirmPasswordInput.value) {
                    confirmPasswordInput.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Check phone number
                const phoneRegex = /^[6-9]\d{9}$/;
                if (!phoneRegex.test(phoneInput.value)) {
                    phoneInput.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Check department
                const departmentInput = document.getElementById('{{ form.department.id_for_label }}');
                if (!departmentInput.value) {
                    departmentInput.classList.add('is-invalid');
                    isValid = false;
                }
                
                // Check name
                const nameInput = document.getElementById('{{ form.name.id_for_label }}');
                if (!nameInput.value.trim() || nameInput.value.trim().length < 2) {
                    nameInput.classList.add('is-invalid');
                    isValid = false;
                }

                // Check unique ID
                const uniqueIdInput = document.getElementById('{{ form.unique_id.id_for_label }}');
                if (!uniqueIdInput.value) {
                    uniqueIdInput.classList.add('is-invalid');
                    isValid = false;
                }
                
                if (isValid) {
                    // Show loading overlay
                    loadingOverlay.classList.add('active');
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Creating...';
                    
                    // Submit form after delay (for UX)
                    setTimeout(() => {
                        form.submit();
                    }, 1500);
                } else {
                    // Scroll to first error
                    const firstError = form.querySelector('.is-invalid');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        firstError.focus();
                    }
                    
                    // Show error message
                    showToast('Please fix the errors in the form', 'error');
                }
            });
            
            // Toast notification function
            function showToast(message, type = 'info') {
                // Remove existing toasts
                const existingToasts = document.querySelectorAll('.custom-toast');
                existingToasts.forEach(toast => toast.remove());
                
                // Create toast
                const toast = document.createElement('div');
                toast.className = `custom-toast toast-${type}`;
                toast.innerHTML = `
                    <div class="toast-content">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                        ${message}
                    </div>
                    <button class="toast-close" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                // Add styles
                const style = document.createElement('style');
                style.textContent = `
                    .custom-toast {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: ${type === 'error' ? '#f8d7da' : type === 'success' ? '#d4edda' : '#d1ecf1'};
                        color: ${type === 'error' ? '#721c24' : type === 'success' ? '#155724' : '#0c5460'};
                        padding: 1rem 1.5rem;
                        border-radius: 12px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        gap: 1rem;
                        z-index: 9999;
                        animation: toastSlideIn 0.3s ease;
                        max-width: 400px;
                        border-left: 4px solid ${type === 'error' ? '#f5c6cb' : type === 'success' ? '#c3e6cb' : '#bee5eb'};
                    }
                    @keyframes toastSlideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    .toast-content {
                        flex: 1;
                        display: flex;
                        align-items: center;
                    }
                    .toast-close {
                        background: none;
                        border: none;
                        color: inherit;
                        cursor: pointer;
                        padding: 0.25rem;
                    }
                `;
                
                document.head.appendChild(style);
                document.body.appendChild(toast);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 5000);
            }
            
            // Initialize character count for phone
            updatePhoneCharCount(phoneInput.value.length);
            
            // Initialize password strength
            if (passwordInput.value) {
                passwordInput.dispatchEvent(new Event('input'));
            }
            
            // Initialize other validations
            if (usernameInput.value) usernameInput.dispatchEvent(new Event('input'));
            if (emailInput.value) emailInput.dispatchEvent(new Event('input'));
            if (confirmPasswordInput.value) confirmPasswordInput.dispatchEvent(new Event('input'));
            if (nameInput.value) nameInput.dispatchEvent(new Event('input'));
            
            // Add focus styling to all form controls
            const formControls = form.querySelectorAll('.form-control-custom');
            formControls.forEach(control => {
                control.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });
                
                control.addEventListener('blur', function() {
                    this.parentElement.classList.remove('focused');
                });
            });
            
            // Add enter key to submit form
            form.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.type !== 'textarea') {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>